<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contractor ZIP Code Selector</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #map {
      height: 500px;
      width: 100%;
    }
    form {
      margin-top: 20px;
    }
    label, input, select {
      margin-bottom: 10px;
      display: block;
    }
    button {
      padding: 10px 20px;
    }
    .zip-label {
      font-size: 14px;
      font-weight: bold;
      color: white;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 4px;
      padding: 2px 4px;
    }
  </style>
</head>
<body>

  <h1>Select Philadelphia ZIP Codes</h1>
  <div id="map"></div>

  <form id="contractorForm">
    <label for="name">Name:</label>
    <input type="text" id="name" required>

    <label for="discipline">Discipline:</label>
    <select id="discipline" required>
      <option value="">Select</option>
      <option value="OT">OT</option>
      <option value="PT">PT</option>
      <option value="SLP">SLP</option>
      <option value="SI">SI</option>
    </select>

    <label for="date">Today's Date:</label>
    <input type="date" id="date" required>

    <label for="caseCount">How many cases are you looking for?</label>
    <input type="number" id="caseCount" min="0" required>

    <label>Availability:</label>
    <table id="availabilityGrid" border="1" style="border-collapse: collapse; margin-bottom: 1rem;">
      <thead>
        <tr>
          <th></th>
          <th>Monday</th>
          <th>Tuesday</th>
          <th>Wednesday</th>
          <th>Thursday</th>
          <th>Friday</th>
          <th>Saturday</th>
          <th>Sunday</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>All Day</td>
          <td><input type="checkbox" name="availability" value="mon_all_day"></td>
          <td><input type="checkbox" name="availability" value="tue_all_day"></td>
          <td><input type="checkbox" name="availability" value="wed_all_day"></td>
          <td><input type="checkbox" name="availability" value="thu_all_day"></td>
          <td><input type="checkbox" name="availability" value="fri_all_day"></td>
          <td><input type="checkbox" name="availability" value="sat_all_day"></td>
          <td><input type="checkbox" name="availability" value="sun_all_day"></td>
        </tr>
        <tr>
          <td>Before 9a</td>
          <td><input type="checkbox" name="availability" value="mon_before_9a"></td>
          <td><input type="checkbox" name="availability" value="tue_before_9a"></td>
          <td><input type="checkbox" name="availability" value="wed_before_9a"></td>
          <td><input type="checkbox" name="availability" value="thu_before_9a"></td>
          <td><input type="checkbox" name="availability" value="fri_before_9a"></td>
          <td><input type="checkbox" name="availability" value="sat_before_9a"></td>
          <td><input type="checkbox" name="availability" value="sun_before_9a"></td>
        </tr>
        <!-- Repeat for other time slots as needed -->
      </tbody>
    </table>

    <label for="locationPref">Where are you comfortable providing services?</label>
    <select id="locationPref" required>
      <option value="">Select</option>
      <option value="home">Home</option>
      <option value="daycare">Daycare</option>
      <option value="both">Both</option>
    </select>

    <label for="serviceMode">I am comfortable providing services:</label>
    <select id="serviceMode" required>
      <option value="">Select</option>
      <option value="in_person">In person</option>
      <option value="virtually">Virtually</option>
      <option value="both">Both</option>
    </select>

    <label for="selectedZipCodes">Selected Zip Codes:</label>
    <textarea id="selectedZipCodes" readonly></textarea>

    <button type="submit">Submit</button>
  </form>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([40.01, -75.15], 11);
    const selectedZipCodes = new Set();

    // Base map layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data Â© OpenStreetMap contributors'
    }).addTo(map);

    // Function to toggle the zip code selection on map click
    function toggleZipSelection(zip, layer) {
      if (selectedZipCodes.has(zip)) {
        selectedZipCodes.delete(zip);
        layer.setStyle({ fillColor: "#3388ff" });
      } else {
        selectedZipCodes.add(zip);
        layer.setStyle({ fillColor: "#ffcc00" });
      }
      // Update the textarea with selected zip codes
      document.getElementById('selectedZipCodes').value = Array.from(selectedZipCodes).join(', ');
    }

    // Load GeoJSON and display ZIP code boundaries
    fetch('philadelphia_zipcodes.geojson')
      .then(response => response.json())
      .then(data => {
        L.geoJSON(data, {
          style: () => ({
            color: "#3388ff",
            weight: 2,
            fillOpacity: 0.5
          }),
          onEachFeature: (feature, layer) => {
            const zip = feature.properties.CODE;
            if (!zip) return;

            layer.bindTooltip(zip.toString(), {
              permanent: true,
              direction: 'center',
              className: 'zip-label'
            });

            layer.on('click', () => toggleZipSelection(zip, layer));
          }
        }).addTo(map);
      });

    // Submit form
    document.getElementById('contractorForm').addEventListener('submit', function (e) {
      e.preventDefault();

      // Collect form data
      const name = document.getElementById('name').value;
      const discipline = document.getElementById('discipline').value;
      const availability = Array.from(document.querySelectorAll('input[name="availability"]:checked')).map(cb => cb.value);
      const zipCodes = Array.from(selectedZipCodes).join(', ');

      // Display form data in console for review
      console.log({ name, discipline, availability, zipCodes });
      alert('Form submitted! Check console for values.');

      // Optionally clear the form
      this.reset();
      selectedZipCodes.clear();
      document.getElementById('selectedZipCodes').value = "";
    });
  </script>
</body>
</html>
