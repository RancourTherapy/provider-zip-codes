<!DOCTYPE html>
<html>
<head>
  <title>Contractor ZIP Code Selector</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #map {
      height: 500px;
      width: 100%;
    }
    form {
      margin-top: 20px;
    }
    label, input {
      margin-bottom: 10px;
      display: block;
    }
    button {
      padding: 10px 20px;
    }
    .zip-label {
      font-size: 14px;
      font-weight: bold;
      color: white;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 4px;
      padding: 2px 4px;
    }
  </style>
</head>
<body>

  <h1>Select Philadelphia ZIP Codes</h1>
  <div id="map"></div>

  <form id="contractorForm">
  <label for="name">Full Name:</label>
  <input type="text" id="name" required>

  <label for="discipline">Discipline:</label>
  <select id="discipline" required>
    <option value="">Select</option>
    <option value="OT">OT</option>
    <option value="PT">PT</option>
    <option value="SLP">SLP</option>
    <option value="SI">SI</option>
  </select>

  <label>Availability:</label>
  <table border="1" cellpadding="5">
    <thead>
      <tr>
        <th>Day</th>
        <th>All Day</th>
        <th>Before 9a</th>
        <th>9a–12p</th>
        <th>12p–3p</th>
        <th>3p–5p</th>
        <th>After 5p</th>
      </tr>
    </thead>
    <tbody>
      <script>
        const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
        const blocks = ["all_day", "before_9a", "9a_12p", "12p_3p", "3p_5p", "after_5p"];
        document.write(days.map(day => `
          <tr>
            <td>${day}</td>
            ${blocks.map(block =>
              `<td><input type="checkbox" name="availability" value="${day}_${block}"></td>`
            ).join('')}
          </tr>
        `).join(''));
      </script>
    </tbody>
  </table>

  <label>Where are you comfortable providing services?</label>
  <label><input type="radio" name="locationPref" value="home" required> Home</label>
  <label><input type="radio" name="locationPref" value="daycare"> Daycare</label>
  <label><input type="radio" name="locationPref" value="both"> Both</label>

  <label>I am comfortable providing services:</label>
  <label><input type="radio" name="serviceMode" value="in_person" required> In person</label>
  <label><input type="radio" name="serviceMode" value="virtually"> Virtually</label>
  <label><input type="radio" name="serviceMode" value="both"> Both</label>

  <label for="today">Today's Date:</label>
  <input type="date" id="today" required>

  <label>Are you looking for more cases right now?</label>
  <label><input type="radio" name="lookingForMore" value="yes" required onchange="toggleCaseInput(true)"> Yes</label>
  <label><input type="radio" name="lookingForMore" value="no" onchange="toggleCaseInput(false)"> No</label>

  <div id="caseCountContainer" style="display:none;">
    <label for="caseCount">If yes, how many cases are you looking for?</label>
    <input type="number" id="caseCount" min="1">
  </div>

  <input type="hidden" id="selectedZipCodes" name="selectedZipCodes">
  <button type="submit">Submit</button>
</form>


  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([40.01, -75.15], 11);
    const selectedZipCodes = new Set();

    // Base map layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data © OpenStreetMap contributors'
    }).addTo(map);

    function toggleZipSelection(zip, layer) {
      if (selectedZipCodes.has(zip)) {
        selectedZipCodes.delete(zip);
        layer.setStyle({ fillColor: "#3388ff" });
      } else {
        selectedZipCodes.add(zip);
        layer.setStyle({ fillColor: "#ffcc00" });
      }
      document.getElementById('selectedZipCodes').value = Array.from(selectedZipCodes).join(',');
    }

    // Load GeoJSON and display ZIP code boundaries
    fetch('philadelphia_zipcodes.geojson')
      .then(response => response.json())
      .then(data => {
        L.geoJSON(data, {
          style: () => ({
            color: "#3388ff",
            weight: 2,
            fillOpacity: 0.5
          }),
          onEachFeature: (feature, layer) => {
            const zip = feature.properties.CODE;
            if (!zip) return;

            layer.bindTooltip(zip.toString(), {
              permanent: true,
              direction: 'center',
              className: 'zip-label'
            });

            layer.on('click', () => toggleZipSelection(zip, layer));
          }
        }).addTo(map);
      });

    // Submit form
    document.getElementById('contractorForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const discipline = document.getElementById('discipline').value;
      const availability = document.getElementById('availability').value;
      const zipCodes = Array.from(selectedZipCodes).join(',');

      // Example: replace with actual submission logic (e.g., Google Sheets API, webhook)
      console.log({ name, discipline, availability, zipCodes });
      alert('Form submitted! Check console for values.');

      // Optionally clear the form
      this.reset();
      selectedZipCodes.clear();
      document.getElementById('selectedZipCodes').value = "";
    });
  </script>
<script>
  function toggleCaseInput(show) {
    const container = document.getElementById('caseCountContainer');
    container.style.display = show ? 'block' : 'none';
    if (!show) document.getElementById('caseCount').value = "";
  }

  document.getElementById('today').valueAsDate = new Date();

  document.getElementById('contractorForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const formData = {
      name: document.getElementById('name').value,
      discipline: document.getElementById('discipline').value,
      date: document.getElementById('today').value,
      lookingForMore: document.querySelector('input[name="lookingForMore"]:checked')?.value,
      caseCount: document.getElementById('caseCount').value || "0",
      availability: Array.from(document.querySelectorAll('input[name="availability"]:checked')).map(cb => cb.value),
      locationPref: document.querySelector('input[name="locationPref"]:checked')?.value,
      serviceMode: document.querySelector('input[name="serviceMode"]:checked')?.value,
      zipCodes: Array.from(selectedZipCodes).join(',')
    };

    console.log(formData);
    alert("Form submitted! Check console for values.");
    this.reset();
    selectedZipCodes.clear();
    document.getElementById('selectedZipCodes').value = "";
    document.getElementById('zipDisplay').innerText = "";
    document.getElementById('today').valueAsDate = new Date();
    toggleCaseInput(false);
  });
</script>
</body>
</html>
